# src/vat/plugins/xss.py

from .xss_payloads import xss_payloads
from ..requests_handler import make_request


def check_xss(url, verify_ssl=True):
    for index, payload in enumerate(xss_payloads):
        response, request_made = make_request(
            url, {"q": payload}, verify_ssl=verify_ssl)

        # Log the payload being tested
        print(f"Testing payload {index + 1}/{len(xss_payloads)}")

        # If a request could not be made, skip to the next payload
        if not request_made:
            continue

        # Check if the payload is reflected in the response text
        if response and payload in response.text:
            print("XSS vulnerability detected!")
            return True, request_made

    print("No XSS vulnerability detected.")
    return False, request_made